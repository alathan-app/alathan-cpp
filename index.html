<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AlAthan</title>
  <meta name="description" content="AlAthan — accurate prayer times, live Qibla, Lock Screen & Dynamic Island countdown, widgets, and Quran Radio." />

  <style>
    :root{
      --bg:#fbfbfd;
      --surface: rgba(255,255,255,.72);
      --surface2: rgba(255,255,255,.56);
      --text:#1d1d1f;
      --muted:#6e6e73;
      --border: rgba(0,0,0,.10);
      --shadow: 0 18px 50px rgba(0,0,0,.10);
      --shadowSoft: 0 10px 26px rgba(0,0,0,.08);

      --radius: 22px;
      --radiusLg: 28px;

      --accent:#0071e3;
      --accent2:#0a84ff;

      --ui:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text","Helvetica Neue",Arial,sans-serif;
      --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;

      --max: 1180px;
      --navH: 58px;

      --phoneW: min(380px, 36vw);
      --phoneH: calc(var(--phoneW) * 2.07);
    }

    @media (prefers-color-scheme: dark){
      :root{
        --bg:#000;
        --surface: rgba(28,28,30,.78);
        --surface2: rgba(28,28,30,.56);
        --text:#f5f5f7;
        --muted:#a1a1a6;
        --border: rgba(255,255,255,.14);
        --shadow: 0 26px 80px rgba(0,0,0,.55);
        --shadowSoft: 0 12px 34px rgba(0,0,0,.45);
        --accent:#0a84ff;
        --accent2:#409cff;
      }
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--ui);
      color: var(--text);
      background: var(--bg);
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      line-height: 1.45;
      overflow-x: hidden;
    }
    a{ color: var(--accent); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    .container{
      width: min(var(--max), calc(100% - 40px));
      margin: 0 auto;
    }

    /* Nav */
    header.nav{
      position: sticky;
      top: 0;
      z-index: 80;
      height: var(--navH);
      display:flex;
      align-items:center;
      border-bottom: 1px solid var(--border);
      background: color-mix(in oklab, var(--bg) 85%, transparent);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }
    @supports not (color-mix(in oklab, red, blue)) {
      header.nav { background: rgba(251,251,253,.85); }
      @media (prefers-color-scheme: dark){ header.nav { background: rgba(0,0,0,.70); } }
    }

    .nav-inner{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 12px;
      min-width: 210px;
    }
    .logo{
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background:
        radial-gradient(18px 18px at 28% 28%, rgba(255,255,255,.85), rgba(255,255,255,0) 65%),
        linear-gradient(135deg, rgba(10,132,255,.92), rgba(0,113,227,.92));
      box-shadow: 0 12px 26px rgba(0,0,0,.14);
      border: 1px solid rgba(255,255,255,.16);
      flex: 0 0 auto;
    }
    .brand h1{
      margin:0;
      font-size: 13.5px;
      font-weight: 700;
      letter-spacing: .2px;
      line-height: 1.1;
    }
    .brand p{
      margin:2px 0 0;
      font-size: 12px;
      color: var(--muted);
    }

    .nav-actions{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap: wrap;
      justify-content:flex-end;
    }

    .seg{
      display:flex;
      border: 1px solid var(--border);
      border-radius: 999px;
      overflow:hidden;
      background: var(--surface2);
    }
    .seg button{
      border:0;
      background: transparent;
      padding: 8px 10px;
      font-size: 12.5px;
      color: var(--muted);
      cursor:pointer;
      transition: background .2s ease, color .2s ease;
    }
    .seg button.active{
      background: rgba(0,113,227,.14);
      color: var(--text);
    }

    .btn{
      border: 1px solid var(--border);
      background: var(--surface2);
      color: var(--text);
      padding: 9px 12px;
      border-radius: 999px;
      font-size: 12.5px;
      display:inline-flex;
      align-items:center;
      gap: 8px;
      cursor:pointer;
      user-select:none;
      transition: transform .15s ease, background .2s ease, border-color .2s ease;
      white-space: nowrap;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn.primary{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:#fff;
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 14px 28px rgba(0,113,227,.22);
    }

    /* Hero */
    section.hero{
      position: relative;
      height: clamp(660px, 96vh, 980px);
      overflow: hidden;
      border-bottom: 1px solid var(--border);
      background: var(--bg);
    }
    .hero-media{
      position:absolute;
      inset:0;
      transform: translateY(var(--pY, 0px)) scale(1.08);
      will-change: transform;
    }
    .hero-media::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(1000px 700px at 20% 20%, rgba(0,113,227,.22), transparent 60%),
        radial-gradient(900px 640px at 82% 22%, rgba(64,156,255,.18), transparent 55%),
        radial-gradient(1100px 700px at 55% 88%, rgba(0,113,227,.12), transparent 62%);
      pointer-events:none;
      z-index: 2;
    }
    .hero-img{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: cover;
      object-position: 50% 35%;
      opacity: .34;
      filter: saturate(1.05) contrast(1.02);
      z-index: 1;
      transform: translateZ(0);
    }
    @media (prefers-color-scheme: dark){
      .hero-img{ opacity: .22; }
      .hero-media::before{ mix-blend-mode: screen; }
    }
    .hero-overlay{
      position:absolute;
      inset:0;
      background: radial-gradient(1200px 700px at 50% 30%, rgba(255,255,255,.55), rgba(255,255,255,0) 60%);
      z-index: 3;
      pointer-events:none;
    }
    @media (prefers-color-scheme: dark){
      .hero-overlay{
        background: radial-gradient(1200px 700px at 50% 30%, rgba(255,255,255,.10), rgba(255,255,255,0) 60%);
      }
    }
    .hero-inner{
      position: relative;
      z-index: 4;
      height:100%;
      display:flex;
      align-items:center;
    }

    .hero-grid{
      width:100%;
      display:grid;
      grid-template-columns: 1.12fr .88fr;
      gap: 28px;
      align-items:center;
    }
    @media (max-width: 980px){
      .hero-grid{
        grid-template-columns: 1fr;
        align-items: start;
        padding-top: 34px;
        gap: 18px;
      }
    }

    .kicker{
      display:inline-flex;
      align-items:center;
      gap:10px;
      border:1px solid var(--border);
      padding:8px 12px;
      border-radius: 999px;
      font-size: 12.5px;
      color: var(--muted);
      background: var(--surface2);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }
    .kicker .dot{
      width:8px;height:8px;border-radius:999px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 4px rgba(0,113,227,.12);
    }
    .hero h2{
      margin: 14px 0 10px;
      font-size: clamp(40px, 5vw, 66px);
      letter-spacing: -0.04em;
      line-height: 1.02;
    }
    .hero p{
      margin: 0 0 18px;
      color: var(--muted);
      font-size: 16px;
      max-width: 70ch;
    }

    .panel{
      border: 1px solid var(--border);
      background: var(--surface);
      border-radius: var(--radiusLg);
      box-shadow: var(--shadowSoft);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      overflow:hidden;
    }
    .panel.pad{ padding: 18px; }

    .field{
      border: 1px solid var(--border);
      background: var(--surface2);
      border-radius: 18px;
      padding: 14px;
    }
    .field label{
      display:block;
      font-size: 11.5px;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .field .val{
      white-space: pre-wrap;
      font-size: 14px;
    }

    /* Chapters */
    main{ display:block; }
    section.chapter{
      padding: 64px 0;
      border-bottom: 1px solid var(--border);
      background:
        radial-gradient(900px 520px at 18% 18%, rgba(0,113,227,.08), transparent 60%),
        radial-gradient(820px 520px at 82% 24%, rgba(64,156,255,.08), transparent 55%),
        var(--bg);
    }
    @media (prefers-color-scheme: dark){
      section.chapter{
        background:
          radial-gradient(900px 520px at 18% 18%, rgba(10,132,255,.06), transparent 60%),
          radial-gradient(820px 520px at 82% 24%, rgba(64,156,255,.05), transparent 55%),
          var(--bg);
      }
    }

    .chapter-inner{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      align-items:start;
    }
    @media (max-width: 980px){
      section.chapter{ padding: 36px 0; }
      .container{ width: min(var(--max), calc(100% - 24px)); }
      .chapter-inner{ grid-template-columns: 1fr; gap: 16px; }
    }

    .badge{
      display:inline-flex;
      border: 1px solid var(--border);
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      background: var(--surface2);
      white-space: nowrap;
      margin-bottom: 14px;
    }

    .chapter h3{
      margin: 0 0 10px;
      font-size: clamp(26px, 3.2vw, 44px);
      letter-spacing: -0.03em;
      line-height: 1.06;
    }
    .lead{
      margin:0 0 14px;
      color: var(--muted);
      font-size: 15.5px;
      max-width: 70ch;
    }

    /* Bullets */
    .bullets{
      margin-top: 14px;
      display:grid;
      gap: 10px;
    }
    .bullet{
      padding: 12px 14px;
      border-radius: 18px;
      border: 1px solid var(--border);
      background: var(--surface);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      box-shadow: var(--shadowSoft);
      cursor:pointer;
      transition: transform .18s ease, border-color .2s ease, background .2s ease;
    }
    .bullet:hover{ transform: translateY(-1px); }
    .bullet.active{
      border-color: rgba(0,113,227,.45);
      background: rgba(0,113,227,.08);
    }
    .bullet .k{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      margin: 0 0 4px;
    }
    .bullet .t{
      margin: 0 0 4px;
      font-weight: 700;
      letter-spacing: -.01em;
      font-size: 14px;
    }
    .bullet .h{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }
    @media (max-width: 980px){
      .bullets{ gap: 12px; }
      .bullet{ padding: 14px 14px; }
      .bullet .t{ font-size: 15px; }
      .bullet .h{ font-size: 13.5px; }
    }

    /* Sticky device mock (desktop), normal card (mobile) */
    .mock-wrap{
      position: sticky;
      top: calc(var(--navH) + 18px);
      height: calc(100vh - var(--navH) - 36px);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    @media (max-width: 980px){
      :root{ --phoneW: min(420px, 92vw); }
      .mock-wrap{
        position: relative;
        top: auto;
        height: auto;
        justify-content:flex-start;
        margin-top: 6px;
      }
    }

    .phone{
      width: var(--phoneW);
      height: var(--phoneH);
      border-radius: 38px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.35));
      box-shadow: var(--shadow);
      position: relative;
      overflow:hidden;
      transform: translateZ(0);
    }
    @media (prefers-color-scheme: dark){
      .phone{
        background: linear-gradient(180deg, rgba(28,28,30,.78), rgba(28,28,30,.42));
      }
    }
    .phone::before{
      content:"";
      position:absolute;
      inset: 10px;
      border-radius: 30px;
      border: 1px solid rgba(255,255,255,.18);
      pointer-events:none;
      z-index: 5;
    }
    .island{
      position:absolute;
      top: 10px;
      left:50%;
      transform: translateX(-50%);
      width: 42%;
      height: 18px;
      border-radius: 999px;
      background: rgba(0,0,0,.35);
      opacity: .35;
      z-index: 6;
    }
    @media (prefers-color-scheme: dark){
      .island{ background: rgba(0,0,0,.62); opacity:.55; }
    }

    .mock{ position:absolute; inset:0; }

    .screen{
      position:absolute;
      inset:0;
      opacity:0;
      transform: scale(1.02) translateY(10px);
      transition: opacity .55s ease, transform .55s ease;
      will-change: opacity, transform;
    }
    .screen.active{
      opacity:1;
      transform: scale(1.0) translateY(0);
    }

    .screen .img{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: cover;
      object-position: 50% 20%;
      filter: saturate(1.05) contrast(1.02);
      transform: translateZ(0);
    }
    @media (prefers-color-scheme: dark){
      .screen .img{ filter: saturate(1.05) contrast(1.05); }
    }

    .screen .caption{
      position:absolute;
      left: 14px;
      right: 14px;
      bottom: 14px;
      padding: 12px 12px;
      border-radius: 22px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.55);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      box-shadow: var(--shadowSoft);
      z-index: 4;
    }
    @media (prefers-color-scheme: dark){
      .screen .caption{ background: rgba(28,28,30,.62); }
    }
    .screen .caption .t{
      margin:0 0 4px;
      font-weight: 800;
      letter-spacing: -.02em;
      font-size: 13.5px;
    }
    .screen .caption .s{
      margin:0;
      color: var(--muted);
      font-size: 12.6px;
      line-height: 1.25;
    }

    /* Reveal */
    .reveal{
      opacity:0;
      transform: translateY(16px);
      transition: opacity .7s ease, transform .7s ease;
      will-change: opacity, transform;
    }
    .reveal.in{ opacity:1; transform: translateY(0); }

    /* RTL */
    .rtl{ direction:rtl; text-align:right; }
    .rtl .nav-inner{ direction:rtl; }
    .rtl .brand{ flex-direction: row-reverse; }
    .rtl .nav-actions{ justify-content:flex-start; }
    .rtl .field label{
      letter-spacing: 0;
      text-transform: none;
      font-weight: 800;
      font-size: 12px;
    }

    html{ scroll-behavior:smooth; }
    @media (prefers-reduced-motion: reduce){
      html{ scroll-behavior:auto; }
      .reveal{ transition:none; transform:none; opacity:1; }
      .btn:hover, .bullet:hover{ transform:none; }
      .screen{ transition:none; }
      .hero-media{ transform:none !important; }
    }
  </style>
</head>

<body>
  <!-- Nav -->
  <header class="nav">
    <div class="container nav-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1 id="navTitle">AlAthan</h1>
          <p id="navSub">Prayer times • Qibla • Lock Screen</p>
        </div>
      </div>

      <div class="nav-actions">
        <div class="seg" role="tablist" aria-label="Language">
          <button id="btn-en" class="active" role="tab" aria-selected="true">EN</button>
          <button id="btn-ar" role="tab" aria-selected="false">AR</button>
        </div>
        <a class="btn primary" href="#chapter-prayer">Explore</a>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero" id="hero">
    <div class="hero-media" id="heroMedia" aria-hidden="true">
      <img class="hero-img" id="heroImg" alt="" />
    </div>
    <div class="hero-overlay" aria-hidden="true"></div>

    <div class="container hero-inner">
      <div class="hero-grid">
        <div class="reveal">
          <div class="kicker">
            <span class="dot" aria-hidden="true"></span>
            <span id="heroKicker">Designed to feel native.</span>
          </div>

          <h2 id="heroTitle">Your daily prayer companion.</h2>
          <p id="heroDesc">
            Accurate prayer times, a live Qibla compass, and smart countdowns on your Lock Screen and Dynamic Island.
          </p>

          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;">
            <a class="btn primary" href="#features">Features</a>
            <a class="btn" href="#chapter-prayer">Screens</a>
          </div>
        </div>

        <aside class="panel pad reveal" id="features">
          <div class="field" style="margin:0;">
            <label id="featuresLabel">App features</label>
            <div class="val" id="featuresText"></div>
          </div>
        </aside>
      </div>
    </div>
  </section>

  <!-- Chapters -->
  <main id="chapters"></main>

  <script>
    // =========================
    // ASSETS (AUTO LIGHT/DARK)
    // =========================
    const BASE = "https://alathan-app.github.io/alathan-cpp/";

    const ASSETS = {
      prayerGrid: { light: BASE + "prayer_grid_light.jpg",        dark: BASE + "prayer_grid_dark.jpg" },
      lockscreenIqama: { light: BASE + "lockscreen_iqama_light.png", dark: BASE + "lockscreen_iqama_dark.png" },
      widgetsStack: { light: BASE + "widgets_stack_light.png",    dark: BASE + "widgets_stack_dark.png" },
      widgetsOverview: { light: BASE + "widgets_overview_light.png", dark: BASE + "widgets_overview_dark.png" },
      quranRadio: { light: BASE + "quran_radio_light.png",        dark: BASE + "quran_radio_dark.png" }
    };

    const mqDark = window.matchMedia("(prefers-color-scheme: dark)");
    const theme = () => (mqDark.matches ? "dark" : "light");
    const asset = (key) => ASSETS[key][theme()];

    function preloadAll(){
      Object.keys(ASSETS).forEach(key => {
        ["light","dark"].forEach(mode => {
          const img = new Image();
          img.src = ASSETS[key][mode];
        });
      });
    }
    preloadAll();

    // =========================
    // FEATURES (EN/AR)
    // =========================
    };

    // =========================
    // CHAPTERS (Apple-style)
    // =========================
    let LANG = "en";

    const CHAPTERS = [
      {
        id: "prayer",
        en: {
          badge: "Prayer times",
          title: "Accurate prayer times. Clean at a glance.",
          lead: "A calm grid that makes the next prayer obvious — with Hijri date and moon phase.",
          bullets: [
            { t:"At-a-glance schedule", h:"Your day in one clean view.", assetKey:"prayerGrid" },
            { t:"Smart countdown", h:"Next prayer, then iqama — always clear.", assetKey:"lockscreenIqama" },
            { t:"Widgets that stay", h:"Use the sizes people actually keep.", assetKey:"widgetsOverview" }
          ]
        },
        ar: {
          badge: "أوقات الصلاة",
          title: "أوقات دقيقة. نظرة واضحة.",
          lead: "شبكة هادئة تُبرز الصلاة القادمة — مع التاريخ الهجري وطور القمر.",
          bullets: [
            { t:"جدول بنظرة واحدة", h:"يومك بالكامل في شاشة واحدة.", assetKey:"prayerGrid" },
            { t:"عدّ تنازلي ذكي", h:"الصلاة التالية ثم الإقامة بوضوح.", assetKey:"lockscreenIqama" },
            { t:"ويدجت تبقى معك", h:"أحجام عملية يستخدمها الناس يومياً.", assetKey:"widgetsOverview" }
          ]
        }
      },
      {
        id: "qibla",
        en: {
          badge: "Qibla",
          title: "Live Qibla, made simple.",
          lead: "A clean experience that feels native — perfect for daily use and travel.",
          bullets: [
            { t:"Live direction", h:"A clear heading and degree readout.", assetKey:"prayerGrid" },
            { t:"Offline-ready", h:"Works without internet.", assetKey:"widgetsStack" },
            { t:"Quick access", h:"Use widgets for instant entry.", assetKey:"widgetsOverview" }
          ]
        },
        ar: {
          badge: "القبلة",
          title: "قبلة مباشرة… ببساطة.",
          lead: "تجربة نظيفة تبدو أصلية — مثالية للاستخدام اليومي والسفر.",
          bullets: [
            { t:"اتجاه حي", h:"قراءة واضحة بالدرجات.", assetKey:"prayerGrid" },
            { t:"يعمل دون إنترنت", h:"ثبات وموثوقية أثناء السفر.", assetKey:"widgetsStack" },
            { t:"وصول سريع", h:"ويدجت للدخول فوراً.", assetKey:"widgetsOverview" }
          ]
        }
      },
      {
        id: "widgets",
        en: {
          badge: "Widgets & Watch",
          title: "Widgets that feel like part of iOS.",
          lead: "Next prayer, countdown, and progress — on Home Screen, Lock Screen, and Apple Watch.",
          bullets: [
            { t:"Widget wall", h:"Multiple sizes with consistent style.", assetKey:"widgetsOverview" },
            { t:"Smart Stack moments", h:"Designed for quick glances.", assetKey:"widgetsStack" },
            { t:"From athan to iqama", h:"Progress you can read instantly.", assetKey:"lockscreenIqama" }
          ]
        },
        ar: {
          badge: "الويدجت والساعة",
          title: "ويدجت تبدو جزءاً من iOS.",
          lead: "الصلاة التالية والعدّ التنازلي وشريط التقدم — على الشاشة الرئيسية والقفل والساعة.",
          bullets: [
            { t:"أحجام متعددة", h:"تنسيق متسق بأسلوب Apple.", assetKey:"widgetsOverview" },
            { t:"لحظات Smart Stack", h:"مصممة للنظرة السريعة.", assetKey:"widgetsStack" },
            { t:"من الأذان للإقامة", h:"تقدم واضح فوراً.", assetKey:"lockscreenIqama" }
          ]
        }
      },
      {
        id: "radio",
        en: {
          badge: "Quran Radio",
          title: "Continuous Quran recitation.",
          lead: "Choose from multiple reciters and stations and start listening instantly.",
          bullets: [
            { t:"Pick a station", h:"Fast selection, minimal UI.", assetKey:"quranRadio" },
            { t:"Listen anytime", h:"Perfect for daily routine.", assetKey:"quranRadio" },
            { t:"Built-in harmony", h:"Matches the rest of the app.", assetKey:"quranRadio" }
          ]
        },
        ar: {
          badge: "راديو القرآن",
          title: "تلاوة قرآنية متواصلة.",
          lead: "اختر من عدة مقرئين ومحطات وابدأ الاستماع فوراً.",
          bullets: [
            { t:"اختر محطة", h:"واجهة بسيطة وسريعة.", assetKey:"quranRadio" },
            { t:"استماع في أي وقت", h:"مناسب لروتينك اليومي.", assetKey:"quranRadio" },
            { t:"تناغم كامل", h:"متناسق مع أسلوب التطبيق.", assetKey:"quranRadio" }
          ]
        }
      }
    ];

    // =========================
    // RENDER HELPERS
    // =========================
    let LANG = "en";

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function renderFeatures(){
      const label = (LANG === "ar" ? "ميزات التطبيق" : "App features");
      document.getElementById("featuresLabel").textContent = label;
      document.getElementById("featuresText").textContent = FEATURES[LANG].join("\n");
    }

    function renderHeroText(){
      if(LANG === "ar"){
        document.documentElement.lang = "ar";
        document.body.classList.add("rtl");

        document.getElementById("navTitle").textContent = "AlAthan";
        document.getElementById("navSub").textContent = "أوقات الصلاة • القبلة • شاشة القفل";

        document.getElementById("heroKicker").textContent = "مصمم ليبدو أصلياً.";
        document.getElementById("heroTitle").textContent = "رفيقك اليومي للصلاة.";
        document.getElementById("heroDesc").textContent =
          "أوقات دقيقة، بوصلة قبلة حيّة، وعدّ تنازلي ذكي على شاشة القفل والجزيرة التفاعلية.";
      }else{
        document.documentElement.lang = "en";
        document.body.classList.remove("rtl");

        document.getElementById("navTitle").textContent = "AlAthan";
        document.getElementById("navSub").textContent = "Prayer times • Qibla • Lock Screen";

        document.getElementById("heroKicker").textContent = "Designed to feel native.";
        document.getElementById("heroTitle").textContent = "Your daily prayer companion.";
        document.getElementById("heroDesc").textContent =
          "Accurate prayer times, a live Qibla compass, and smart countdowns on your Lock Screen and Dynamic Island.";
      }
    }

    function renderChapters(){
      const host = document.getElementById("chapters");
      host.innerHTML = "";

      CHAPTERS.forEach((c) => {
        const t = c[LANG];

        const screens = t.bullets.map((b, i) => `
          <div class="screen ${i===0 ? "active":""}" data-bullet="${i}">
            <img class="img" data-asset-key="${escapeHtml(b.assetKey)}" src="${escapeHtml(asset(b.assetKey))}" alt="" loading="eager" />
            <div class="caption">
              <p class="t">${escapeHtml(b.t)}</p>
              <p class="s">${escapeHtml(b.h)}</p>
            </div>
          </div>
        `).join("");

        const bullets = t.bullets.map((b, i) => `
          <div class="bullet ${i===0 ? "active":""}" data-chapter="${c.id}" data-bullet="${i}">
            <p class="k">${LANG==="ar" ? "لقطة" : "Shot"} ${i+1}</p>
            <p class="t">${escapeHtml(b.t)}</p>
            <p class="h">${escapeHtml(b.h)}</p>
          </div>
        `).join("");

        const el = document.createElement("section");
        el.className = "chapter";
        el.id = `chapter-${c.id}`;

        el.innerHTML = `
          <div class="container chapter-inner">
            <div class="reveal">
              <div class="badge">${escapeHtml(t.badge)}</div>
              <h3>${escapeHtml(t.title)}</h3>
              <p class="lead">${escapeHtml(t.lead)}</p>
              <div class="bullets">${bullets}</div>
            </div>

            <div class="mock-wrap reveal">
              <div class="phone" aria-label="Screenshot preview">
                <div class="island" aria-hidden="true"></div>
                <div class="mock">${screens}</div>
              </div>
            </div>
          </div>
        `;

        host.appendChild(el);
      });

      // Bullet click handlers
      document.querySelectorAll(".bullet").forEach(b => {
        b.addEventListener("click", () => {
          const chapterId = b.getAttribute("data-chapter");
          const idx = Number(b.getAttribute("data-bullet"));
          activateBullet(chapterId, idx);
        });
      });
    }

    function activateBullet(chapterId, bulletIndex){
      document.querySelectorAll(`.bullet[data-chapter="${chapterId}"]`).forEach(el => {
        el.classList.toggle("active", Number(el.getAttribute("data-bullet")) === bulletIndex);
      });

      document.querySelectorAll(`#chapter-${chapterId} .screen`).forEach(el => {
        el.classList.toggle("active", Number(el.getAttribute("data-bullet")) === bulletIndex);
      });
    }

    // =========================
    // OBSERVERS
    // =========================
    let ioReveal;
    function wireReveal(){
      ioReveal?.disconnect();
      ioReveal = new IntersectionObserver((entries)=>{
        entries.forEach(e => { if(e.isIntersecting) e.target.classList.add("in"); });
      }, { threshold: 0.12 });
      document.querySelectorAll(".reveal").forEach(el => ioReveal.observe(el));
    }

    let ioBullets;
    function wireAutoAdvance(){
      ioBullets?.disconnect();
      ioBullets = new IntersectionObserver((entries)=>{
        const visible = entries.filter(e => e.isIntersecting);
        if(!visible.length) return;
        const best = visible.sort((a,b)=>b.intersectionRatio - a.intersectionRatio)[0];
        const chapter = best.target.getAttribute("data-chapter");
        const bullet = Number(best.target.getAttribute("data-bullet"));
        if(chapter && Number.isFinite(bullet)) activateBullet(chapter, bullet);
      }, { threshold:[0.25,0.45,0.65], rootMargin: "-25% 0px -55% 0px" });

      document.querySelectorAll(".bullet").forEach(el => ioBullets.observe(el));
    }

    // =========================
    // HERO PARALLAX
    // =========================
    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
    function onScrollParallax(){
      const hero = document.getElementById("hero");
      const media = document.getElementById("heroMedia");
      if(!hero || !media) return;
      const rect = hero.getBoundingClientRect();
      const progress = clamp((-rect.top) / rect.height, 0, 1);
      const y = Math.round(progress * 52);
      media.style.setProperty("--pY", `${y * -1}px`);
    }

    // =========================
    // THEME SWITCH (LIGHT/DARK)
    // =========================
    const heroImg = document.getElementById("heroImg");

    function applyThemeAssets(){
      heroImg.src = asset("prayerGrid");
      document.querySelectorAll("img[data-asset-key]").forEach(img => {
        const k = img.getAttribute("data-asset-key");
        img.src = asset(k);
      });
    }

    mqDark.addEventListener("change", applyThemeAssets);

    // =========================
    // LANGUAGE TOGGLE
    // =========================
    function setLang(lang){
      LANG = lang;

      document.getElementById("btn-en").classList.toggle("active", lang === "en");
      document.getElementById("btn-ar").classList.toggle("active", lang === "ar");

      renderHeroText();
      renderFeatures();
      renderChapters();

      wireReveal();
      wireAutoAdvance();

      applyThemeAssets();

      // Reset to first bullet in each chapter
      CHAPTERS.forEach(c => activateBullet(c.id, 0));
    }

    document.getElementById("btn-en").addEventListener("click", ()=>setLang("en"));
    document.getElementById("btn-ar").addEventListener("click", ()=>setLang("ar"));

    // =========================
    // INIT
    // =========================
    heroImg.src = asset("prayerGrid");
    renderHeroText();
    renderFeatures();
    renderChapters();

    wireReveal();
    wireAutoAdvance();

    CHAPTERS.forEach(c => activateBullet(c.id, 0));

    onScrollParallax();
    window.addEventListener("scroll", onScrollParallax, { passive:true });
  </script>
</body>
</html>
